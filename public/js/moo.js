// Generated by CoffeeScript 1.3.3
var Alert, HelpBubbles, Scrollbars, TaskStatus, protrada, toggleSidebar;

toggleSidebar = function(e) {
  var $aside;
  $aside = $("aside");
  $aside.toggleClass("active");
  $(document.body).toggleClass("sidebar-hidden sidebar-open");
  $("#main-container, .task-status").delay(($(document.body).hasClass("sidebar-hidden") ? 200 : 0)).animate({
    width: ($aside.hasClass("active") ? "99.999" : "100") + "%"
  }, 200, function() {
    Scrollbars.updateAll();
    $("#grid-view").grid("windowResize");
  });
};

protrada = {
  version: "3a2",
  cachedAt: 1343982244107,
  scrollbars: {
    elements: {},
    add: function(identifier, $element, options) {
      this.elements[identifier] = $element.tinyscrollbar(options || {});
    },
    update: function(identifier, type) {
      this.elements[identifier].tinyscrollbar_update(type || "relative");
    },
    updateAll: function(type) {
      var that;
      that = this;
      $.each(this.elements, function(i, v) {
        that.update(i, type);
      });
    },
    offset: function(identifier) {
      this.elements[identifier].tinyscrollbar_offset();
    },
    remove: function(identifier) {
      this.elements[identifier].children(".scrollbar").remove();
    }
  },
  alert: {
    show: function(message) {
      $("#sys-alert").removeClass("hidden").find(".alertmsg-container").find("span").text(message);
    },
    hide: function() {
      $("#sys-alert").addClass("hidden");
    }
  },
  taskStatus: {
    show: function(type, message) {
      $.app.growl.show(type, message);
    },
    hide: function() {
      $.app.growl.hide();
    }
  },
  helpBubbles: {
    bubbles: {}
  }
};

Scrollbars = protrada.scrollbars;

TaskStatus = protrada.taskStatus;

Alert = protrada.alert;

HelpBubbles = protrada.helpBubbles;

$(document).ready(function() {
  var module;
  module = document.URL.substr(document.URL.lastIndexOf("/") + 1) || "home";
  if (module !== "") {
    $.app.state.update("modules.selected", module);
    $.app.state.get(function() {
      $.app.state.restoreModule();
    });
  }
  $("#ui-controls").on("click", "a", function(e) {
    var classes;
    classes = {
      condensed: "condensed",
      downgrade: "mobile",
      helpbubbles: "help"
    };
    e.preventDefault();
    $(document.body).toggleClass(classes[this.id.replace(/toggle|-/g, "")]);
    $(this).toggleClass("active");
    $.app.state.update("system_options.toggles." + this.id, $(this).hasClass("active"));
  });
  $("#toggle-condensed").toggleClass("active", $(document.body).hasClass("condensed"));
  $("#toggle-downgrade").toggleClass("active", $(document.body).hasClass("mobile"));
  $("#toggle-sys-menu").on("click", function(e) {
    e.preventDefault();
    $(this).add("#sys-menu").toggleClass("active");
  });
  $("#x-sys-menu").on("click", function(e) {
    e.preventDefault();
    $("#sys-menu, #toggle-sys-menu").removeClass("active");
  });
  $("#mode-rocker").on("click", function(e) {
    e.preventDefault();
    $("#system-rocker").find("h3").toggleClass("hidden");
    $(this).toggleClass("active");
    $.app.state.update("system_options.mode", $("#system-rocker").find("h3").not(".hidden").attr("id"));
  });
  if ($(document.body).hasClass("mobile")) {
    $("#notifications").addClass("native");
  }
  Scrollbars.add("notifications", $("#notifications").not(".native"), {
    lockscroll: false
  });
  $("#spine-inner").find("nav").find("a").mouseup(function() {
    $(this).removeClass("active");
  }).mousedown(function() {
    $(this).addClass("active");
  }).mouseout(function() {
    $(this).removeClass("active");
  });
  $(document).on("click", ".hide-all-bubbles", function(e) {
    e.preventDefault();
    $("#toggle-help-bubbles").trigger("click");
  });
  $(document).on("click", ".x-help-bubble", function(e) {
    e.preventDefault();
    $(this).closest(".help-bubble-container").hide();
  });
});

$(document).on("click", "#toggle-side-bar, #x-side-bar", function() {
  toggleSidebar();
  $.app.state.update("sidebar.visible", !$(document.body).hasClass("sidebar-hidden"));
});

$(document).on("click", ".x-alert-msg", function() {
  $(this).parent().slideUp(450, function() {
    $(this).remove();
    Scrollbars.update("notifications");
  });
});

$(document).on("click", ".nav-tabs li a", function(e) {
  e.preventDefault();
  $(this).tab("show");
});

$(document).on("click", "#alert-msgs a", function(e) {
  e.preventDefault();
  $(this).tab("show");
  Scrollbars.update("notifications");
});

$(document).on("restore", function() {
  var sidebar, state;
  state = $.app.state.current.system_options;
  sidebar = $.app.state.current.sidebar;
  if (state !== undefined) {
    $.each(state.toggles, function(k, v) {
      var id;
      id = "#ui-controls #" + k;
      if ((v && !$(id).hasClass("active")) || (!v && $(id).hasClass("active"))) {
        $(id).click();
      }
    });
    $("#system-rocker").find("h3").addClass("hidden").filter("#" + state.mode).removeClass("hidden");
    $("#mode-rocker").removeClass("active").addClass(function() {
      if (state.mode === "devname") {
        return "active";
      } else {
        return "";
      }
    });
  }
  if ((sidebar !== undefined ? sidebar.visible !== undefined : void 0) ? (sidebar.visible && $(document.body).hasClass("sidebar-hidden")) || (!sidebar.visible && !$(document.body).hasClass("sidebar-hidden")) : void 0) {
    toggleSidebar();
  }
});
